<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <style>
    body {
      background: linear-gradient(135deg, #74ebd5 0%, #9face6 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
      height: 100vh;
    }

    .form-container {
      background-color: #fff;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 600px;
    }

    .form-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .form-header h2 {
      font-weight: 600;
      font-size: 1.8rem;
      color: #333;
    }

    .form-label {
      font-weight: 500;
      color: #555;
    }

    .btn-primary {
      background-color: #007bff;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      font-weight: 600;
      transition: background-color 0.3s, transform 0.2s;
    }

    .btn-primary:hover {
      background-color: #003063 !important;
      transform: translateY(-1px);
    }

    input {
      border-radius: 5px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .form-check-label {
      margin-left: 5px;
    }

    .alert-message {
      text-align: center;
      color: rgb(228, 17, 17);
      font-weight: 500;
      margin-top: 10px;
    }
  </style>
  <body style="background-color:#E2E2E2;">
    <div class="d-flex flex-column align-items-center justify-content-center w-100 h-100">
      
      <div class="p-4 m-3 rounded-4 w-50 shadow" style="background-color: rgb(255, 255, 255);color: rgb(122, 122, 122);">
          <!--hedder-->
          <div class="text-center mb-4">
            <samp class="" style="font-family:Arial, Helvetica, sans-serif;font-size: 2rem;">Personal Details</samp>
          </div>

          <!--form body-->
          <div class="col-12">

            <div class="row g-2">
              <div class="col-md-6 input-group-sm">
                <label for="first-name" class="form-label">First Name</label>
                <input type="text" class="form-control" id="firstName">
              </div>
              <div class="col-md-6 input-group-sm">
                <label for="first-name" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="lastName">
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="row g-2">
              <div class="col-md-6 input-group-sm">
                <label for="first-name" class="form-label">NIC</label>
                <input type="text" class="form-control" id="NIC">
              </div>
              <div class="col-md-6 input-group-sm">
                <label for="first-name" class="form-label">Birth Day</label>
                <input type="date" class="form-control" id="datepicker">
              </div>
            </div>
          </div>

          

          <div class="col-12">
            <div class="row g-2">
              <div class="col-md-6 input-group-sm">
                <label for="inputEmail4" class="form-label">Email</label>
                <input type="email" class="form-control" id="email">
              </div>
    
              <div class="col-md-6 input-group-sm">
                <label for="inputEmail4" class="form-label">Phone No</label>
                <input type="number" class="form-control" id="phone">
              </div>
            </div>
          </div>
          
          <div class="col-12 input-group-sm">
            <label for="inputAddress" class="form-label">Address</label>
            <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St">
          </div>

          <div class="col-12 input-group-sm">
            <label for="inputAddress2" class="form-label">Address 2</label>
            <input type="text" class="form-control" id="inputAddress2" placeholder="Apartment, studio, or floor">
          </div>

          <div class="col-md-12">
            <div class="row g-2">
              <div class="col-md-6 input-group-sm">
                <label for="inputCity" class="form-label">City</label>
                <input type="text" class="form-control" id="inputCity">
              </div>
              <div class="col-md-6 input-group-sm">
                <label for="inputCity" class="form-label">location</label>
                <input type="text" class="form-control" id="location">
              </div>
            </div>
          </div>

          

          <div class="col-12 mt-3 input-group-sm ">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="checkbox">
              <label class="form-check-label" for="gridCheck">
                Agree with all policies
              </label>
            </div>
          </div>

          <div class="col-12 d-flex justify-content-end">
            <button id="btnNext" class="btn btn-primary px-4 py-1"  onclick="createPerson()">Next</button>
          </div>
      </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script>

      function convertDmsToDecimal(coordString) {
          const coords = coordString.split(',').map(coord => parseFloat(coord.trim()));

          // Check if both latitude and longitude are parsed correctly
          if (coords.length === 2 && !isNaN(coords[0]) && !isNaN(coords[1])) {
              return coords;  // Return the coordinates as an array of numbers
          } else {
              return [undefined, undefined];  // Return undefined if the input format is incorrect
          }
      }


      function createPerson() {
        var locationValue = $('#location').val().trim();
        const [latitude, longitude] = convertDmsToDecimal(locationValue);
        if (validateInputFeild()) {
          $.ajax({
            url: 'SignUpController.php',
            method: 'post',
            data: {
              action: 'createUserSession',
              firstName: $('#firstName').val().trim(),
              lastName: $('#lastName').val().trim(),
              NIC: $('#NIC').val().trim(),
              email: $('#email').val().trim(),
              phone: $('#phone').val().trim(),
              inputAddress: $('#inputAddress').val().trim(),
              inputAddress2: $('#inputAddress2').val().trim(),
              inputCity: $('#inputCity').val().trim(),
              bday: $('#datepicker').val().trim(),
              latitude: latitude,
              longitude: longitude
            },
            success: function(response) {
              $('body').fadeOut(1000, function() { // 1000ms = 1 second
                window.location.href = 'FormSetPassword.html'; // Redirect after fade out
              });
            },
            error: function() {
              alert("System error");
            }
          });
        }
        
      }

      function validateInputFeild() {
    
          var firstName = $('#firstName').val().trim();
          var lastName = $('#lastName').val().trim();
          var NIC = $('#NIC').val().trim();
          var email = $('#email').val().trim();
          var phone = $('#phone').val().trim();
          var inputAddress = $('#inputAddress').val().trim();
          var inputAddress2 = $('#inputAddress2').val().trim();
          var inputCity = $('#inputCity').val().trim();
          var Checkbox = $('#checkbox').is(':checked');
          var datepicker = $('#datepicker').val().trim();
          var locationValue = $('#location').val().trim();

          const [latitude, longitude] = convertDmsToDecimal(locationValue);
          

          // Check for empty fields
          if (firstName === "") {
              alert("First name cannot be empty.");
              $('#firstName').focus();
              return false;
          }
          if (lastName === "") {
              alert("Last name cannot be empty.");
              $('#lastName').focus();
              return false;
          }
          if (NIC === "") {
              alert("NIC cannot be empty.");
              $('#NIC').focus();
              return false;
          }

          // Validate Sri Lankan NIC (old or new format)
          const nicRegex = /^([0-9]{9}[vVxX]|[0-9]{12})$/;
          if (!nicRegex.test(NIC)) {
              alert("Invalid NIC format.");
              $('#NIC').focus();
              return false;
          }

          if (datepicker === "") {
              alert("Birth date cannot be empty.");
              $('#datepicker').focus();
              return false;
          }

          // Check if the selected date is not in the future
          var selectedDate = new Date(datepicker);
          var today = new Date();
          today.setHours(0, 0, 0, 0); // Reset time part for accurate comparison

          if (selectedDate > today) {
              alert("Birth date cannot be in the future.");
              $('#datepicker').focus();
              return false;
          }

          if (email === "") {
              alert("Email cannot be empty.");
              $('#email').focus();
              return false;
          }
          const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
          if (!emailRegex.test(email)) {
              alert("Invalid email format.");
              $('#email').focus();
              return false;
          }

          if (phone === "") {
              alert("Phone number cannot be empty.");
              $('#phone').focus();
              return false;
          }

          // Check phone number length, numeric value, and no negative value
          if (phone.length !== 10 || isNaN(phone) || parseInt(phone) < 0) {
              alert("Phone number should be exactly 10 digits and cannot be negative.");
              $('#phone').focus();
              return false;
          }

          if (inputAddress === "") {
              alert("Address cannot be empty.");
              $('#inputAddress').focus();
              return false;
          }
          if (inputAddress2 === "") {
              alert("Address 2 cannot be empty.");
              $('#inputAddress2').focus();
              return false;
          }
          if (inputCity === "") {
              alert("City cannot be empty.");
              $('#inputCity').focus();
              return false;
          }
          if (latitude == undefined && longitude == undefined) {
              alert("Ivalied Location Patern!");
              $('#location').focus();
              return false;
          } else {
            console.log(latitude);
            console.log(longitude);
          } 

          if (!Checkbox) {
              alert("Please check the checkbox.");
              $('#checkbox').focus();
              return false;
          }

          return true;
      }


  </script>
  </body>
</html>