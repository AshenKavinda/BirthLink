<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>midwife</title>

    <link rel="stylesheet" href="selectmother.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
      .container{
            max-width: 1000px; /* Width of the container */
            margin: 50px auto; 
            background: #ffffff; /* White background for the card */
            padding: 30px;
            border-radius: 20px; /* More rounded corners for a softer look */
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); /* Enhanced shadow */
            border: none; /* Remove border for a cleaner look */
            transition: transform 0.3s; /* Smooth hover effect */
        }
        body{
            /* background-color:  rgb(98, 90, 216); */
            background: linear-gradient(135deg, #74ebd5 0%, #9face6 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body>

    <div class="container my-3">
        <h1 class="text-center">Midwife</h1>
        
        <div class="d-flex my-5 justify-content-between">
          <div>
            <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#addNewMidwife">Add New Midwife</button>
          </div>
          <div class="d-flex gap-3">
            <div>
                <input type="text" class="form-control" id="searchId" placeholder="Search by ID">
            </div>
            <div>
                <button type="button" class="btn btn-dark" onclick="searchMidwife()">Search</button>
            </div>
        </div>  
        </div>
        <div id="displayTable"></div>


    </div>
    <!--Add Modal -->
    <div class="modal fade" id="addNewMidwife" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Add New Midwife</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row g-2">
                <div class="col-md-6 input-group-sm">
                  <label for="firstName" class="form-label">First Name</label>
                  <input type="text" class="form-control" id="firstName" name="firstName" placeholder="Enter First Name">
                </div>
                <div class="col-md-6 input-group-sm">
                  <label for="lastName" class="form-label">Last Name</label>
                  <input type="text" class="form-control" id="lastName" name="lastName" placeholder="Enter Last Name">
                </div>
              </div>
      
              <div class="row g-2 mt-2">
                <div class="col-md-6 input-group-sm">
                  <label for="NIC" class="form-label">NIC</label>
                  <input type="text" class="form-control" id="NIC" placeholder="Enter NIC">
                </div>
                <div class="col-md-6 input-group-sm">
                    <label for="phone" class="form-label">Center</label>
                    <select id="center" class="form-select" aria-label="Default select example">
                      <option selected>Open this select menu</option>
                  </select>
                  </div>
              </div>
      
              <div class="row g-2 mt-2">
                <div class="col-md-6 input-group-sm">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" placeholder="abcdefg123@gmail.com">
                </div>
                <div class="col-md-6 input-group-sm">
                  <label for="phone" class="form-label">Phone No</label>
                  <input type="text" class="form-control" id="phone" placeholder="0#########">
                </div>
              </div>
      
              <div class="row g-2 mt-2">
                <div class="col-12 input-group-sm">
                  <label for="inputAddress" class="form-label">Address</label>
                  <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main Street">
                </div>
                <div class="col-12 input-group-sm mt-2">
                  <label for="inputAddress2" class="form-label">Address 2</label>
                  <input type="text" class="form-control" id="inputAddress2" placeholder="Apartment, studio">
                </div>
              </div>

              <div class="row g-2 mt-2">
                <div class="col-md-6 input-group-sm">
                  <label for="inputCity" class="form-label">City</label>
                  <input type="text" class="form-control" id="city" placeholder="Enter City">
                </div>
                <div class="col-md-6 input-group-sm">
                  <label for="inputPassword" class="form-label">Password</label>
                  <input type="text" class="form-control" id="password" placeholder="!@#$%^&*">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary px-5 border-0" onclick="addMidwife()">Add</button>
              <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
              <input type="hidden" id="hiddenData">
            </div>
          </div>
        </div>
    </div>
      
    <!-- Update Modal -->

    <div class="modal fade" id="updateMother" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Update Midwife</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row g-2">
              <div class="col-md-6 input-group-sm">
                <label for="firstName" class="form-label">First Name</label>
                <input type="text" class="form-control" id="upfirstName" name="firstName" placeholder="Enter First Name">
              </div>
              <div class="col-md-6 input-group-sm">
                <label for="lastName" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="uplastName" name="lastName" placeholder="Enter Last Name">
              </div>
            </div>
    
            <div class="row g-2 mt-2">
              <div class="col-md-6 input-group-sm">
                <label for="NIC" class="form-label">NIC</label>
                <input type="text" class="form-control" id="upNIC" placeholder="Enter NIC">
              </div>
              <div class="col-md-6 input-group-sm">
                <label for="phone" class="form-label">Change Center</label>
                <select id="upcenter" class="form-select" aria-label="Default select example">
                  <option selected>Open this select menu</option>
              </select>
              </div>
            </div>
    
            <div class="row g-2 mt-2">
              <div class="col-md-6 input-group-sm">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="upemail" placeholder="abcdefg123@gmail.com">
              </div>
              <div class="col-md-6 input-group-sm">
                <label for="phone" class="form-label">Phone No</label>
                <input type="text" class="form-control" id="upphone" placeholder="0#########">
              </div>
            </div>
    
            <div class="row g-2 mt-2">
              <div class="col-12 input-group-sm">
                <label for="inputAddress" class="form-label">Address</label>
                <input type="text" class="form-control" id="upinputAddress" placeholder="1234 Main Street">
              </div>
            </div>

            
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary px-5 border-0" onclick="updateMidwife()">Update</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            <input type="hidden" id="hiddenData">
          </div>  
        </div>
      </div>
    </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  
    <script>
        $(document).ready(function() {
            displayData();
            centerDropDown();
        });


        function addMidwife(){
         
          if(validateInputFeildAdd()){
            
            $.ajax({
              url: "midwifeController.php",
                  type: 'post',
                  data: {
                      action: "add",
                      mfname: $('#firstName').val().trim(),
                      mlname: $('#lastName').val().trim(),
                      mnic: $('#NIC').val().trim(),
                      memail: $('#email').val().trim(),
                      mphon: $('#phone').val().trim(),
                      madd1: $('#inputAddress').val().trim(),
                      madd2: $('#inputAddress2').val().trim(),
                      mcity: $('#city').val().trim(),
                      mpass: $('#password').val().trim(),
                      center: $('#center').val()
                  },
                  success: function() {
                    alert("Midwife added successfully!");
                    displayData();
                  },
                  error: function(xhr) {
                      alert("Error fetching data: " + xhr.responseText);
                  }
                
            })
          }
          else{
            alert("validate error");
          }
        }

        function validateInputFeildAdd() {
    
            var firstName = $('#firstName').val().trim();
            var lastName = $('#lastName').val().trim();
            var NIC = $('#NIC').val().trim();
            var email = $('#email').val().trim();
            var phone = $('#phone').val().trim();
            var inputAddress = $('#inputAddress').val().trim();
            var inputAddress2 = $('#inputAddress2').val().trim();
            var inputCity = $('#city').val().trim();
            var password = $('#password').val().trim();
            var selectedCenter = $('#center').val();

            if (firstName === "") {
            alert("First name cannot be empty.");
            $('#firstName').focus();
            return false;
            }
            if (lastName === "") {
            alert("Last name cannot be empty.");
            $('#lastName').focus();
            return false;
            }
            if (NIC === "") {
            alert("NIC cannot be empty.");
            $('#NIC').focus();
            return false;
            }
            if (email === "") {
            alert("Email cannot be empty.");
            $('#email').focus();
            return false;
            }
            const regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!regex.test(email)) {
            alert("Email not valied.");
            $('#email').focus();
            return false;
            }
            if (phone === "") {
            alert("Phone number cannot be empty.");
            $('#phone').focus();
            return false;
            }
            if (isNaN(phone)) {
            alert("Phone number should be numeric.");
            $('#phone').focus();
            return false;
            }
            if (inputAddress === "") {
            alert("Address cannot be empty.");
            $('#inputAddress').focus();
            return false;
            }
            if (inputAddress2 === "") {
            alert("Address 2 cannot be empty.");
            $('#inputAddress2').focus();
            return false;
            }
            if (inputCity === "") {
            alert("City cannot be empty.");
            $('#city').focus();
            return false;
            }
            if (password === "") {
            alert("Password cannot be empty.");
            $('#password').focus();
            return false;
            }
            if (selectedCenter === "" || selectedCenter === null) {
            alert("Please select a center");
            return;
            }

            return true;
        }

        function displayData() {        
            $.ajax({
                url: "midwifeController.php",
                type: 'post',
                data: {
                    action: "setMidwifeTable",
                    motherData: true
                },
                success: function(data) {
                    $('#displayTable').html(data);
                },
                error: function(xhr) {
                    alert("Error fetching data: " + xhr.responseText);
                }
            });
        }

        function searchMidwife() {

        const id = $('#searchId').val();

        if (id === "") {
            displayData();
            return;
        }

            $.ajax({
                url: "midwifeController.php",
                type: 'post',
                data: {
                    action: "searchMidwifeTable",
                    mID: id
                },
                success: function(data) {
                    $('#displayTable').html(data);
                },
                error: function(xhr) {
                    alert("Error fetching data: " + xhr.responseText);
                }
            });
          }

        function getMidwifeDetails(uID) {

            $.ajax({
                url: "midwifeController.php",
                type: 'post',
                data: {
                    action: "getMidwifeDetails",
                    uID: uID
                },
                success: function(response) {

                    const midwife = JSON.parse(response);
                     console.log(midwife);

                    $('#upfirstName').val(midwife.fName);
                    $('#uplastName').val(midwife.lName);
                    $('#upNIC').val(midwife.nic);
                    $('#upemail').val(midwife.email);
                    $('#upphone').val(midwife.contactNo);
                    $('#upinputAddress').val(midwife.address);
                    $('#upcenter').val(midwife.centerID);
                    
                    $('#hiddenData').val(uID);

                    $('#updateMother').modal('show');
                },
                error: function(xhr,status,error) {
                var respose = JSON.parse(xhr.responseText);
                var errorMessage = respose.error || "An unknown error occurred.";
                alert("Error: "+errorMessage);
            }
            });

        }

        function updateMidwife() {

          const uID = $('#hiddenData').val();

          if(validateInputFeildUpdate()){
            $.ajax({
                url: "midwifeController.php",
                type: 'post',
                data: {
                    action: "updateMidwife",
                    uID: uID,
                      mfname: $('#upfirstName').val().trim(),
                      mlname: $('#uplastName').val().trim(),
                      mnic: $('#upNIC').val().trim(),
                      memail: $('#upemail').val().trim(),
                      mphon: $('#upphone').val().trim(),
                      madd1: $('#upinputAddress').val().trim(),
                      center: $('#upcenter').val()

                },
                success: function(response) {
                    displayData();
                    $('#displayTable').html(response);
                    $('#updateMother').modal('hide');
                    alert("Officer updated successfully!");
                },
                error: function(xhr,status,error) {
                  var respose = JSON.parse(xhr.responseText);
                  var errorMessage = respose.error || "An unknown error occurred.";
                  alert("Error: "+errorMessage);
              }
            });
          }  
        }

        function validateInputFeildUpdate() {
    
        var firstName = $('#upfirstName').val().trim();
        var lastName = $('#uplastName').val().trim();
        var NIC = $('#upNIC').val().trim();
        var email = $('#upemail').val().trim();
        var phone = $('#upphone').val().trim();
        var inputAddress = $('#upinputAddress').val().trim();
        var selectedCenter = $('#upcenter').val();

        if (firstName === "") {
          alert("First name cannot be empty.");
          $('#upfirstName').focus();
          return false;
        }
        if (lastName === "") {
          alert("Last name cannot be empty.");
          $('#uplastName').focus();
          return false;
        }
        if (NIC === "") {
          alert("NIC cannot be empty.");
          $('#upNIC').focus();
          return false;
        }
        if (email === "") {
          alert("Email cannot be empty.");
          $('#upemail').focus();
          return false;
        }
        const regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if (!regex.test(email)) {
          alert("Email not valied.");
          $('#upemail').focus();
          return false;
        }
        if (phone === "") {
          alert("Phone number cannot be empty.");
          $('#upphone').focus();
          return false;
        }
        if (isNaN(phone)) {
          alert("Phone number should be numeric.");
          $('#upphone').focus();
          return false;
        }
        if (inputAddress === "") {
          alert("Address cannot be empty.");
          $('#upinputAddress').focus();
          return false;
        }
        return true;
      }

  
        function deleteMidwife(id) {

        if(confirm("Confirm deletion ?")){
          $.ajax({
              url: "midwifeController.php",
              type: 'post',
              data: { 
              action: "deleteMidwife",
              mid: id },
              success: function(data, status) {
                  displayData();
              },
              error: function(xhr) {
                  alert("Error deleting data: " + xhr.responseText);
              }
          });
        }
      }

      function centerDropDown()
        {
            $.ajax({
                url: 'midwifeController.php',
                method: 'post',
                data: {
                    action: 'getCenter'
                },
                success: function(response) {
                     $('#center').html(response); 
                     $('#upcenter').html(response);
                    
                },
                error: function(xhr, status, error) {
                    var respose = JSON.parse(xhr.responseText);
                    var errorMessage = respose.error || "An unknown error occurred.";
                    alert("Error: " + errorMessage);
                }
            });
      }

        
    </script>
</body>
</html>