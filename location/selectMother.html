<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Mother</title>

    <link rel="stylesheet" href="selectmother.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
        <div class="container my-3">

            <div class="d-flex gap-3 mx-5 my-5" style="justify-content: right;">
                <div>
                    <input type="text" class="form-control" id="searchId" placeholder="Search by ID">
                </div>
                <div>
                    <button type="button" class="btn btn-dark" onclick="searchMother()">Search</button>
                </div>
            </div>   
            <div id="displayTable"></div>
        </div>

    
    <script>

        function getCurrentLocation(callback) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        let originLat = position.coords.latitude;
                        let originLng = position.coords.longitude;
                        console.log(`Current Location: Latitude ${originLat}, Longitude ${originLng}`);
                        callback(originLat, originLng); // Pass to the callback function
                    },
                    function(error) {
                        console.error("Error fetching location: ", error);
                        alert("Unable to retrieve your location.");
                    },
                    {
                        enableHighAccuracy: true // Optionally request higher accuracy
                    }
                );
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function openGoogleMaps(destLat, destLng) {
            getCurrentLocation(function(originLat, originLng) {
                // Construct the URL
                let url = `https://www.google.com/maps/dir/?api=1&origin=${originLat},${originLng}&destination=${destLat},${destLng}&travelmode=driving`;
                
                // Check if the user is on a mobile device
                if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
                    // Open the Google Maps app
                    window.location.href = `geo:${originLat},${originLng}?q=${destLat},${destLng}`;
                } else {
                    // Open in browser
                    window.open(url, '_blank');
                }
            });
        }



        $(document).ready(function() {
            displayData();
        });

        function displayData() {        
            $.ajax({
                url: "selectMotherController.php",
                type: 'post',
                data: {
                    action: "setMotherTable",
                    motherData: true
                },
                success: function(data) {
                    $('#displayTable').html(data);
                },
                error: function(xhr) {
                    alert("Error fetching data: " + xhr.responseText);
                }
            });
        }

        function searchMother() {
            const nic = $('#searchId').val();

            $.ajax({
                url: "selectMotherController.php",
                type: 'post',
                data: {
                    action: "searchMotherTable",
                    nic: nic
                },
                success: function(data) {
                    $('#displayTable').html(data);
                },
                error: function(xhr,status,error) {
                    var respose = JSON.parse(xhr.responseText);
                    var errorMessage = respose.error || "An unknown error occurred.";
                    alert("Error: "+errorMessage);
                }
            });
        }
    </script>
    
</body>
</html>
